<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.66">
 <TITLE>grc65 -- GEOS Resource Compiler: Building a GEOS VLIR overlay application</TITLE>
 <LINK HREF="grc65-6.html" REL=next>
 <LINK HREF="grc65-4.html" REL=previous>
 <LINK HREF="grc65.html#toc5" REL=contents>
</HEAD>
<BODY>
<A HREF="grc65-6.html">Next</A>
<A HREF="grc65-4.html">Previous</A>
<A HREF="grc65.html#toc5">Contents</A>
<HR>
<H2><A NAME="building-vlir"></A> <A NAME="s5">5.</A> <A HREF="grc65.html#toc5">Building a GEOS VLIR overlay application</A></H2>

<P>Large GEOS applications typically don't fit in one piece in their designated
memory area.  They are therefore split into overlays which are loaded into memory
on demand.  The individual overlays are stored as records of a VLIR (Variable
Length Index Record) file.  When GEOS starts a VLIR overlay appliation it loads
record number 0 which is supposed to contain the main program.  The record numbers
starting with 1 are to be used for the actual overlays.</P>
<P>In "<CODE>cc65/samples/geos</CODE>" there's a VLIR overlay demo application consisting
of the files "<CODE>overlay-demo.c</CODE>" and "<CODE>overlay-demores.grc</CODE>".</P>


<H2><A NAME="ss5.1">5.1</A> <A HREF="grc65.html#toc5.1">Building the GEOS overlay application using cl65</A>
</H2>

<P>This is a simple one step process:
<BLOCKQUOTE><CODE>
<PRE>
cl65 -t geos-cbm -O -o overlay-demo.cvt -m overlay-demo.map overlay-demores.grc overlay-demo.c
</PRE>
</CODE></BLOCKQUOTE>

Always place the <CODE>.grc</CODE> file as first input file on the command-line in order
to make sure that the generated <CODE>.h</CODE> file is available when it is needed for
inclusion by a <CODE>.c</CODE> file.</P>
<P>You will almost certainly want to generate a map file that shows (beside a lot of
other infos) how large your individual overlays are.  This info is necessary to tune
the distribution of code into the overlays and to optimize the memory area reserved
for the overlays.</P>


<H2><A NAME="ss5.2">5.2</A> <A HREF="grc65.html#toc5.2">Building the GEOS overlay application without cl65</A>
</H2>

<H3>First step -- compiling the overlay resources</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
grc65 -t geos-cbm overlay-demores.grc
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Second step -- assembling the overlay application header</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
ca65 -t geos-cbm overlay-demores.s
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Third step -- compiling the overlay code</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
cc65 -t geos-cbm -O overlay-demo.c
ca65 -t geos-cbm overlay-demo.s
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Fourth and last step -- linking the overlay application</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
ld65 -t geos-cbm -o overlay-demo.cvt -m overlay-demo.map overlay-demores.o overlay-demo.o geos-cbm.lib
</PRE>
</CODE></BLOCKQUOTE>
</P>



<HR>
<A HREF="grc65-6.html">Next</A>
<A HREF="grc65-4.html">Previous</A>
<A HREF="grc65.html#toc5">Contents</A>
</BODY>
</HTML>
